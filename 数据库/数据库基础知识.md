# 网络基础 #
# 1.OSI七层模型 #
1. 物理层：通过媒介传输比特,确定机械及电气规范,传输单位为bit
2. 数据链路层：将比特组装成帧和点到点的传递,传输单位为帧,主要包括的协议为MAC VLAN PPP
3. 网络层：负责数据包从源到宿的传递和网际互连，传输单位为包,主要包括的协议为IP ARP ICMP
4. 传输层：提供端到端的可靠报文传递和错误恢复，传输单位为报文,主要包括的协议为TCP UDP
5. 会话层：建立、管理和终止会话，传输单位为SPDU，主要包括的协议为RPC NFS
6. 表示层：对数据进行翻译、加密和压缩,传输单位为PPDU，主要包括的协议为JPEG ASII
7. 应用层：允许访问OSI环境的手段,传输单位为APDU，主要包括的协议为FTP HTTP DNS

## 2.四层模型 ##
- 网络接口层、网络层、传输层、应用层

## 3.TCP三次握手的原因 ##
- 三次握手可以防止已经失效的连接请求报文突然又传输到服务器端导致的服务器资源浪费。例如，客户端先发送了一个SYN，但是由于网络阻塞，该SYN数据包在某个节点长期滞留。然后客户端又重传SYN数据包并正确建立TCP连接，然后传输完数据后关闭该连接。该连接释放后失效的SYN数据包才到达服务器端。在二次握手的前提下，服务器端会认为这是客户端发起的又一次请求，然后发送SYN ，并且在服务器端创建socket套接字，一直等待客户端发送数据。但是由于客户端并没有发起新的请求，所以会丢弃服务端的SYN 。此时服务器会一直等待客户端发送数据从而造成资源浪费

## 4.四次挥手的原因 ##
- 由于连接的关闭控制权在应用层，所以被动关闭的一方在接收到FIN包时，TCP协议栈会直接发送一个ACK确认包，优先关闭一端的通信。然后通知应用层，由应用层决定什么时候发送FIN包。应用层可以使用系统调用函数read==0来判断对端是否关闭连接。

## 5.TCP拥塞控制 ##
- 慢开始：最开始发送方的拥塞窗口为1，由小到大逐渐增大发送窗口和拥塞窗口。每经过一个传输轮次，拥塞窗口cwnd加倍。当cwnd超过慢开始门限，则使用拥塞避免算法，避免cwnd增长过大
- 拥塞避免：在慢开始和拥塞避免的过程中，一旦发现网络拥塞，就把慢开始门限设为当前值的一半，并且重新设置cwnd为1，重新慢启动。（乘法减小，加法增大）
- 快重传：接收方每次收到一个失序的报文段后就立即发出重复确认，发送方只要连续收到三个重复确认就立即重传（尽早重传未被确认的报文段）
- 快恢复：当发送方连续收到了三个重复确认，就乘法减半（慢开始门限减半），将当前的cwnd设置为慢开始门限，并且采用拥塞避免算法（连续收到了三个重复请求，说明当前网络可能没有拥塞）

## 6.TCP与UDP的区别 ##
- TCP面向连接，UDP无连接
- TCP点对点服务，UDP支持一对一、一对多通讯
- TCP可靠传输，UDP不可靠传输

## 7.time_wait状态 ##
- 待整理

## 8.epoll的LT模式和ET模式 ##
- LT模式：当epoll_wait检测到fd上有事件发生通知应用程序后，应用程序可以不立即处理该事件。当应用程序下一次调用epoll_wait时，epoll_wait还会再次向应用程序通知此事件，直到此事件被处理
- ET模式：当epoll_wait检测到fd上有事件发生并将此事件通知应用程序后，应用程序必须立即处理该事件，因为后续的epoll_wait调用将不再向应用程序通知这一事件

## 9.TCP粘包问题 ##
- 粘包现象：TCP粘包是指发送方发送的若干包数据到接收方接收时粘成一包，从接收缓冲区看，后一包数据的头紧接着前一包数据的尾
- 粘包原因：发送方原因，TCP默认会使用Nagle算法, TCP为了提高传输效率，发送方一般会收集到足够多的数据然后一次性发送，若连续几次发送的数据都很少，接收方就接收到了粘包数据；接收方原因，接收方用户进程不及时接收数据，多个包被储存在接收缓存里，从而导致粘包问题
- 粘包处理：发送方，关闭Nagle算法来解决，使用TCP_NODELAY选项来关闭Nagle算法；接收方，格式化数据，每条数据有固定的格式（开始符、结束符），这种方法简单易行，但选择开始符和结束符的时候一定要注意每条数据的内部一定不能出现开始符或结束符；发送长度，发送每条数据的时候，将数据的长度一并发送，比如可以选择每条数据的前4位是数据的长度，应用层处理时可以根据长度来判断每条数据的开始和结束